var liveAccountForm=function(){if("object"!=typeof fxcmcom)return!1;fxcmcom.api_endpoint=fxcmcom.api_endpoint||"";var y={},t=fxcmcom.api_endpoint,h=fxcmcom.base_url,b=!1,v={lod_pages:{},app_messages:{}},_=[],k={standard:{countries:[],platforms:[]}},x={country:!1,execution:"dd",platform:"",product:"",accountType:"",standardAccountConsent:!1,rb:""},C={$form:$("form#live-account"),$submitBtn:"",$countrySelect:"",$platformSelect:"",$accountTypeSelect:"",$standardAccountCheckbox:"",$messages:""},S=function(e,t){if("object"!=typeof e||!e.length||!t)return"";for(var r,a=[],o=0;o<e.length;o++){switch(e[o].type){case"restricted":r=v.app_messages.restricted.replace("%%country%%",t.localeName);break;case"email":r=v.app_messages.email.replace("%%email%%",'<a href="mailto:'+e[o].email+'">'+e[o].email+"</a>");break;case"custom":r=(r=(r=e[o].customMsg.replace("%%email%%",'<a href="mailto:'+e[o].email+'">'+e[o].email+"</a>")).replace("%%website%%",'<a href="'+e[o].liveUrl+"?country="+t.slug+'">'+e[o].homeUrl+"</a>")).replace("%%language%%",e[o].lang);break;case"lod":r=(r=v.app_messages.lod.replace("%%platform%%",e[o].platform)).replace(/%%lod-link\(([^)]+)\)%%/,'<a href="'+e[o].link+'" target="_blank">$1</a>');break;default:r=e.length<2&&b?v.app_messages.redirect_req.replace("%%website%%",'<a href="'+e[o].liveUrl+"?country="+t.slug+'">'+e[o].homeUrl+"</a>"):e[o].lang?(r=v.app_messages.redirect_multi.replace("%%website%%",'<a href="'+e[o].liveUrl+"?country="+t.slug+'">'+e[o].homeUrl+"</a>")).replace("%%language%%",e[o].lang):v.app_messages.redirect_multi_no_lang.replace("%%website%%",'<a href="'+e[o].liveUrl+"?country="+t.slug+'">'+e[o].homeUrl+"</a>")}a.push(r)}return a.length?a.join(""):""},r=function(){var e,t={country:{$field:C.$countrySelect,value:fxcm.lib.getURLParameter("country")},platform:{$field:C.$platformSelect,value:fxcm.lib.getURLParameter("platform")},accountType:{$field:C.$accountTypeSelect,value:fxcm.lib.getURLParameter("account_type")}};for(var r in t)t[r].value&&("select"===(e=t[r].$field).prop("tagName").toLowerCase()?e.prop("selectedIndex",e.find('option[value="'+t[r].value+'"]').index()).trigger("change"):"checkbox"===e.attr("type")&&e.prop("checked",!0).trigger("change"))};return y.validateFields=function(e){var t,r,a,o,n="input"===e.tagName.toLowerCase()?$(e).attr("type"):e.tagName.toLowerCase(),c=$(e).attr("id"),i=void 0!==t&&"object"==typeof x.country?x.country[t]:x.country,l=C.$form.find("input, select").not(C.$countrySelect);switch(n){case"select":$(e).find("option:selected").attr("value");break;case"checkbox":$(e).prop("checked")}C.$messages.empty().parent(".form-cell").addClass("hidden"),"country"===c&&(a=$(e).find("option:selected"),o=a.val(),i=""===o?x.country=!1:(x.country={id:a.attr("id"),localeName:a.text(),name:a.attr("data-name-orig"),slug:o},x.country),l.parent(".form-cell").removeClass("hidden"));var s=function(a){if(b=!0,!a)return[];var o=[],n={};function findCountryMessages(e,t){for(var r=0;r<e.length;r++)e[r]===a.slug&&("restricted"===t.name?n={type:"restricted"}:(n={type:t.app_message_level||"redirect",lang:t.language||!1,homeUrl:t.home_url||!1,liveUrl:t.live_url||!1,email:t.email_address||!1,customMsg:t.app_custom_message||""},t.app_message_level&&!t.block_app&&(b=!1)),n.homeUrl&&new RegExp(h).test(n.homeUrl)?b=!1:o.push(n))}for(var e=0;e<_.length;e++)"object"==typeof _[e].countries&&findCountryMessages(_[e].countries,_[e]),"object"==typeof _[e].countries_secondary&&findCountryMessages(_[e].countries_secondary,_[e]);return o.length||(b=!1),o}(i),u=S(s,i);if(b)return l.parent(".form-cell").addClass("hidden"),u.length&&(C.$messages.append("<h4>"+i.localeName+"</h4>"+u).parent(".form-cell").removeClass("hidden"),"function"==typeof gtmDecorateUrls&&gtmDecorateUrls(C.$messages[0])),y.updateBtnUrl(!1),!1;var m,d,f=C.$platformSelect.find("option:selected").val(),p=C.$accountTypeSelect.parent(),g=C.$standardAccountCheckbox.parent();k.hasOwnProperty("limited_risk")&&-1<k.limited_risk.countries.indexOf(x.country.slug)?p.removeClass("hidden"):(C.$accountTypeSelect.val("limited_risk"),p.addClass("hidden"),g.addClass("hidden"),C.$standardAccountCheckbox.prop("checked",!1)),x.accountType=(m=C.$accountTypeSelect.find("option:selected"),""===(d=m.val())?x.accountType=!1:(x.accountType=d,x.accountType)),"standard"===x.accountType&&-1<k.limited_risk.countries.indexOf(x.country.slug)?g.removeClass("hidden"):(g.addClass("hidden"),C.$standardAccountCheckbox.prop("checked",!1)),x.standardAccountConsent=C.$standardAccountCheckbox.prop("checked"),"platform"!==c&&(C.$platformSelect.find("option").each(function(e,t){k.limited_risk&&-1<k.limited_risk.countries.indexOf(x.country.slug)?t.disabled=k[x.accountType].platforms.indexOf(t.value)<0:t.disabled=!1}),!C.$platformSelect.find("option:selected").is(":disabled")&&fxcmRbs.getRb({country:i.slug,platform:f,type:"live"})||C.$platformSelect.find("option").each(function(e,t){var r=$(t).attr("value"),a=t.disabled,o=fxcmRbs.getRb({country:i.slug,platform:r,type:"live"});if(!a&&o)return f=r,C.$platformSelect.prop("selectedIndex",e),!1})),"string"==typeof v.lod_pages[f]&&(u+=S([{type:"lod",link:v.lod_pages[f],platform:C.$platformSelect.find("option:selected").html()}],i)),u.length&&(C.$messages.append(u).parent(".form-cell").removeClass("hidden"),"function"==typeof gtmDecorateUrls&&gtmDecorateUrls(C.$messages[0])),x.platform=f,x.rb=fxcmRbs.getRb({country:i.slug,platform:f,type:"live",limitedRiskAccount:!(!k.limited_risk||k.limited_risk.countries.indexOf(x.country.slug)<0)&&"limited_risk"===x.accountType}),r=fxcmRbs.getRbProps(x.rb),x.product=r&&r.spreadBet?"FX-SB":"FX",!k.limited_risk||k.limited_risk.countries.indexOf(x.country.slug)<0?y.updateBtnUrl(y.generateURL()):y.updateBtnUrl(!("limited_risk"!==x.accountType&&!x.standardAccountConsent)&&y.generateURL())},y.updateBtnUrl=function(e){"string"==typeof e?(C.$submitBtn.attr("href",e),C.$submitBtn.removeClass("disabled")):(C.$submitBtn.attr("href",""),C.$submitBtn.addClass("disabled"))},y.generateURL=function(){if(!x.rb)return!1;var e="https://secure4.fxcorporate.com/tr45/app/getStarted.st?rb="+x.rb;if(fxcmBackBase.bbCountryEligible(x.country.slug)&&-1<fxcmcom.backbase_onboarding_platforms.indexOf(x.platform))return e=fxcmBackBase.getBackBaseUrl();var t="function"==typeof gtmGenerateDecoratedUrl&&gtmGenerateDecoratedUrl(e);return e="string"==typeof t?t:e},y.attachHandlers=function(){C.$form.find("input, select").on("change",function(){var e;y.validateFields(this),"select"===$(this).prop("tagName").toLowerCase()?e=$(this).find("option:selected").attr("value"):"checkbox"===$(this).attr("type")&&(e=$(this).prop("checked")),amplify.publish("fxcm.form.onFxcmAccountFieldChange",{fieldName:$(this).attr("name"),value:e}),lightcase.resize()}),C.$submitBtn.on("click",function(e){C.$form.data("form-start")||fxcm.gtm.formStart(C.$form[0],C.$submitBtn[0]),this.getAttribute("href")?amplify.publish("fxcm.form.onFxcmAccountComplete",{formName:C.$form.attr("name"),rb:x.rb,platform:x.platform,formCountry:x.country.name,execution:x.execution,product:x.product}):e.preventDefault()})},y.setupElements=function(){C.$submitBtn=C.$form.find("a#account-apply"),C.$countrySelect=C.$form.find("select#country"),C.$platformSelect=C.$form.find("select#platform"),C.$accountTypeSelect=C.$form.find("select#account_type"),C.$standardAccountCheckbox=C.$form.find("#acknowledge_account_type"),C.$messages=C.$form.find("#messages")},y.init=function(e){e=e||C.$form,C.$form=$(e),y.setupElements(),C.$form.find('select:not( #country ) > option[value=""]:first-child').remove(),_=fxcmCountryBuckets.getAllBuckets(),function(){for(var e=fxcmRbs.getRbMap("live"),t=0;t<e.length;t++)if("on"===e[t].limited_risk_account?(k.hasOwnProperty("limited_risk")||(k.limited_risk={platforms:[],countries:[]}),k.limited_risk.platforms.push(e[t].platform)):k.standard.platforms.indexOf(e[t].platform)<0&&k.standard.platforms.push(e[t].platform),k.hasOwnProperty("limited_risk")){if(e[t].countries)for(var r=0;r<e[t].countries.length;r++)k.limited_risk.countries.push(e[t].countries[r]);if(e[t].country_buckets)for(var a=0;a<e[t].country_buckets.length;a++)for(var o=0;o<_.length;o++)if(_[o].name===e[t].country_buckets[a]){for(var n=0;n<_[o].countries.length;n++)k.limited_risk.countries.push(_[o].countries[n]);for(n=0;n<_[o].countries_secondary.length;n++)k.limited_risk.countries.push(_[o].countries_secondary[n])}}C.$platformSelect.find("option").each(function(e,t){var r=$(t).attr("value");k.hasOwnProperty("limited_risk")?k.standard.platforms.indexOf(r)<0&&k.limited_risk.platforms.indexOf(r)<0&&$(t).remove():k.standard.platforms.indexOf(r)<0&&$(t).remove()}),C.$accountTypeSelect.find("option").each(function(e,t){var r=$(t).attr("value");k.hasOwnProperty(r)||$(t).remove()})}(),fxcmSimpleAjax.get(t+"/account-messages/",function(e){if(!e)return!1;if(v=e,$("body").hasClass("global-country-selected"))y.validateFields(C.$countrySelect[0]),r();else{var t=setTimeout(function(){y.validateFields(C.$countrySelect[0]),r()},500);amplify.subscribe("fxcm.form.onGlobalCountrySelect",function(e){t.clearTimeout(),y.validateFields(C.$countrySelect[0]),r()})}}),y.attachHandlers()},y}();jQuery(document).ready(function(e){"object"==typeof fxcmRbs&&fxcmRbs.getRbMap("live").length?liveAccountForm.init(e("form#live-account")):amplify.subscribe("fxcm.rbs.onLoad",function(){liveAccountForm.init(e("form#live-account"))}),amplify.subscribe("fxcm.overlay.onOpen.form",function(){e(lightcase.get("content")).find("form#live-account")[0]&&liveAccountForm.init(e(lightcase.get("content")).find("form#live-account"))})});
//# sourceMappingURL=live-account.min.js.map
