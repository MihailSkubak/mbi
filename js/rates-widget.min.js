/*!
 * Dependencies: angular
*/
fxcm.registration=fxcm.registration||{},fxcm.registration.widgetTemplates=[{url:"rates-default.html",markup:'<div class="rates-default"><h3 class="widget-title margin-bottom-15">{{labels.Title}}</h3><table class="rates-table" ng-class="{ \'static\' : !liveState }"><thead><tr><th class="rw-symbol">{{labels.Pair}}</th><th ng-show="liveState" class="rw-bid">{{labels.Bid}}</th><th ng-show="liveState" class="rw-ask">{{labels.Ask}}</th><th class="rw-spread">{{labels.Spread}}</th></tr></thead><tbody><tr ng-repeat="rate in rates | rateFilter : symbols:products:exclude"><td ng-class="{ \'rw-rate-change\' : rate.SpreadChange != 0 }" class="rw-symbol">{{rate.Symbol}}</td><td ng-show="liveState" ng-class="{ \'price-up\' : rate.BidChange > 0, \'price-down\' : rate.BidChange < 0 }" class="rw-bid"><span>{{rate.Bid}}</span></td><td ng-show="liveState" ng-class="{ \'price-up\' : rate.AskChange > 0, \'price-down\' : rate.AskChange < 0 }" class="rw-ask"><span>{{rate.Ask}}</span></td><td ng-class="{ \'price-up\' : rate.SpreadChange > 0, \'price-down\' : rate.SpreadChange < 0 }" class="rw-spread"><span>{{rate.Spread}}</span></td></tr></tbody></table><p ng-show="liveState" class="widget-timestamp">{{labels.LastUpdated}}: {{timestamp}}</p><p ng-show="liveState" ng-hide="autoRefresh"><a class="btn txt-align-center" href="#" ng-click="updateRates($event)">{{labels.Refresh}}</a></p></div>'},{url:"rates-clean-no-title.html",markup:'<div class="rates-default no-title"><table class="rates-table" ng-class="{ \'static\' : !liveState }"><thead><tr><th class="rw-symbol">{{labels.Pair}}</th><th ng-show="liveState" class="rw-bid">{{labels.Bid}}</th><th ng-show="liveState" class="rw-ask">{{labels.Ask}}</th><th class="rw-spread">{{labels.Spread}}</th></tr></thead><tbody><tr ng-repeat="rate in rates | rateFilter : symbols:products:exclude"><td ng-class="{ \'rw-rate-change\' : rate.SpreadChange != 0 }" class="rw-symbol">{{rate.Symbol}}</td><td ng-show="liveState" ng-class="{ \'price-up\' : rate.BidChange > 0, \'price-down\' : rate.BidChange < 0 }" class="rw-bid"><span>{{rate.Bid}}</span></td><td ng-show="liveState" ng-class="{ \'price-up\' : rate.AskChange > 0, \'price-down\' : rate.AskChange < 0 }" class="rw-ask"><span>{{rate.Ask}}</span></td><td ng-class="{ \'price-up\' : rate.SpreadChange > 0, \'price-down\' : rate.SpreadChange < 0 }" class="rw-spread"><span>{{rate.Spread}}</span></td></tr></tbody></table><p ng-show="liveState" class="widget-timestamp">{{labels.LastUpdated}}: {{timestamp}}</p><p ng-show="liveState" ng-hide="autoRefresh"><a class="btn txt-align-center" href="#" ng-click="updateRates($event)">{{labels.Refresh}}</a></p></div>'},{url:"rates-market-scanner.html",markup:'<div class="spreadWidgetTable widget-rates-live rates-market-scanner"  ng-class="{ \'static\' : !liveState }"><div ng-repeat="rate in rates | rateFilter : symbols:products:exclude" class="spreadWidgetRow"><p ng-show="liveState" ng-class="{ \'spreadWidgetCellPriceUp\' : rate.BidChange > 0, \'spreadWidgetCellPriceDown\' : rate.BidChange < 0 }" class="rw-bid margin-0 txt-align-center"><span>{{rate.Bid}}</span></p></div></div>'},{url:"pro-market-depth.html",markup:'<div class="rates-market-depth"><table class="rates-table" ng-class="{ \'static\' : !liveState }"><thead><tr><th class="rw-symbol">{{labels.Pair}}</th><th ng-show="liveState" class="rw-bid">{{labels.Bid}}</th><th ng-show="liveState" class="rw-bid"></th><th class="rw-spread">{{labels.Spread}}</th><th ng-show="liveState" class="rw-ask"></th><th ng-show="liveState" class="rw-ask">{{labels.Ask}}</th></tr></thead><tbody><tr ng-repeat="rate in rates | rateFilter : symbols:products:exclude"><td ng-class="{ \'rw-rate-change\' : rate.SpreadChange != 0 }" class="rw-symbol">{{rate.Symbol}}</td><td ng-show="liveState" class="rw-bid">{{rate.BidVol}}</td><td ng-show="liveState" ng-class="{ \'price-up\' : rate.BidChange > 0, \'price-down\' : rate.BidChange < 0 }" class="rw-bid"><span>{{rate.Bid}}</span></td><td ng-class="{ \'price-up\' : rate.SpreadChange > 0, \'price-down\' : rate.SpreadChange < 0 }" class="rw-spread"><span>{{rate.Spread}}</span></td><td ng-show="liveState" ng-class="{ \'price-up\' : rate.AskChange > 0, \'price-down\' : rate.AskChange < 0 }" class="rw-ask"><span>{{rate.Ask}}</span></td><td ng-show="liveState" class="rw-ask">{{rate.AskVol}}</td></tr></tbody></table><p ng-show="liveState" class="widget-timestamp">{{labels.LastUpdated}}: {{timestamp}}</p><p ng-show="liveState" ng-hide="autoRefresh"><a class="btn txt-align-center" href="#" ng-click="updateRates($event)">{{labels.Refresh}}</a></p></div>'}],fxcm.rates=new function(){this.Widget=fxcm.lib.makeClass(),this.Widget.prototype.init=function(e,g){var t=fxcm.angular.getAppID(e),a=fxcm.angular.getAppName(t),r=fxcm.angular.createApp(t,a);if(this.scope=function(){return angular.element(document.getElementById(t)).scope()},!r)return!1;r.run(["$templateCache",function(e){if("object"==typeof fxcm.registration.widgetTemplates&&fxcm.registration.widgetTemplates.length)for(var t=0;t<fxcm.registration.widgetTemplates.length;t++){var a=fxcm.registration.widgetTemplates[t];"object"==typeof a&&"string"==typeof a.url&&a.url.length&&"string"==typeof a.markup&&a.markup.length&&e.put(a.url,a.markup)}}]),r.factory("fetchService",["$http",function(r){return{getData:function(e,t){var a="string"==typeof e&&"dd"===e.toLowerCase()?"//ratesjson.fxcm.com/DataDisplayerMKTs?callback=JSON_CALLBACK":"//ratesjson.fxcm.com/DataDisplayer?callback=JSON_CALLBACK";return a=t?"//ratesjson.fxcm.com/DataDisplayerPro?callback=JSON_CALLBACK":a,a+="&t="+moment().valueOf(),r.jsonp(a).then(function(e){return e.data})}}}]),r.factory("configService",[function(){var e="object"==typeof g?g:{},t={en:{Title:"Active Trader Spreads",Pair:"Symbol",Bid:"Bid",Ask:"Ask",Spread:"Spread",LastUpdated:"Last Updated",Refresh:"Refresh",Loading:"Loading",About:"About this widget",DecimalToComma:!1},ca:{Title:"Friedberg Direct Spreads",Pair:"Symbol",Bid:"Bid",Ask:"Ask",Spread:"Spread",LastUpdated:"Last Updated",Refresh:"Refresh",Loading:"Loading",About:"About this widget",DecimalToComma:!1},fr:{Pair:"Symbole",Bid:"Vente",Ask:"Achat",Spread:"Spread",LastUpdated:"Dernière mise à jour",Refresh:"Refresh",Loading:"Loading",About:"À propos de ce widget",DecimalToComma:!0},de:{Pair:"Symbol",Bid:"Bid",Ask:"Ask",Spread:"Spread",LastUpdated:"Zuletzt Aktualisiert",Refresh:"Refresh",Loading:"Loading",About:"Über dieses Widget",DecimalToComma:!0},es:{Title:"Active Trader Spreads",Pair:"SÍMBOLO",Bid:"Bid",Ask:"Ask",Spread:"Spread",LastUpdated:"Última actualización:",Refresh:"Refrescar",Loading:"Cargando",About:"Acerca de este widget",DecimalToComma:!1},it:{Title:"Spread Active Trader",Pair:"Strumento",Bid:"Bid",Ask:"Ask",Spread:"Spread",LastUpdated:"Ultimo Aggiornamento",Refresh:"Refresh",Loading:"Loading",About:"A proposito di questo widget",DecimalToComma:!0},ar:{Title:"السبريد للحسابات الذهبية",Pair:"الرمز",Bid:" العرض",Ask:" الطلب",Spread:"السبريد",LastUpdated:" آخر تحديث",Refresh:"Refresh",Loading:"Loading",About:"حول هذه القائمة",DecimalToComma:!0},gr:{Title:"Active Trader Spreads",Pair:"ΣΥΜΒΟΛΟ",Bid:"ΠΩΛΗΣΗ",Ask:"ΑΓΟΡΑ",Spread:"SPREAD",LastUpdated:"Τελευταία Ενημέρωση",Refresh:"Ανανέωση",Loading:"Φόρτωση",About:"Σχετικά με αυτό το widget",DecimalToComma:!1}},a=[];for(var r in t)a.push(r);var s="string"==typeof e.language&&-1<a.indexOf(e.language)?e.language:"en",n="number"==typeof e.interval&&0<e.interval?1e3*e.interval:3e3,i="number"==typeof e.deltaTimeout&&0<e.deltaTimeout?1e3*e.deltaTimeout:500,o="boolean"==typeof e.manual&&e.manual,l="boolean"==typeof e.static&&e.static,d=[],c=[],p=[],u="string"==typeof e.execution?e.execution:"ndd";function _addToArr(e,t){var a=[];"string"==typeof e&&e.length?a=e.split(","):"object"==typeof e&&(a=e);for(var r=0;r<a.length;r++)"string"==typeof a[r]&&a[r].length&&t.indexOf(a[r])<1&&t.push(a[r]);return t}function _removeFromArr(e,t){var a=[];for("string"==typeof e&&e.length?a=e.split(","):"object"==typeof e&&(a=e);0<a.length;){for(var r=a[a.length-1],s=0;-1<(s=t.indexOf(r));)t.splice(s,1);a.pop()}return t}function _replaceArr(e,t){var a=[];"string"==typeof e&&e.length?a=e.split(","):"object"==typeof e&&(a=e);for(var r=[],s=0;s<a.length;s++)"string"==typeof a[s]&&a[s].length&&r.push(a[s]);return r.length&&(t=r),t}return moment.locale(s),d=_addToArr(e.symbols,d),c=_addToArr(e.products,c),p=_addToArr(e.exclude,p),{productTypeMap:{1:"forex",2:"stock-indices",3:"oil-gas",4:"treasury",5:"metals",7:"forex-baskets",8:"stock-baskets",9:"cryptocurrencies"},isStatic:function(){return l},isMarketDepth:function(){return/^\/pro\//.test(document.location.pathname)},toggleStatic:function(e){return"boolean"==typeof e&&(l=e),l},getExecution:function(){return u},getInterval:function(){return n},setInterval:function(e){return"number"==typeof e&&(n=e),n},getDeltaTimeout:function(){return i},setDeltaTimeout:function(e){return"number"==typeof e&&(i=e),i},getSymbols:function(){return d},getProducts:function(){return c},getExclusions:function(){return p},addSymbols:function(e){return d=_addToArr(e,d)},addProducts:function(e){return c=_addToArr(e,c)},addExclusions:function(e){return p=_addToArr(e,p)},removeSymbols:function(e){return d=_removeFromArr(e,d)},removeProducts:function(e){return c=_removeFromArr(e,c)},removeExclusions:function(e){return p=_removeFromArr(e,p)},setSymbols:function(e){return d=_replaceArr(e,d)},setProducts:function(e){return c=_replaceArr(e,c)},setExclusions:function(e){return p=_replaceArr(e,p)},generateLabels:function(){return t[s]},doAutoRefresh:function(){return!o}}}]),r.service("ratesService",["configService",function(s){var l=[];this.formatRates=function(e,t){if("object"==typeof e&&"object"==typeof e.Rates&&e.Rates.length){for(var a=[],r=0;r<e.Rates.length;r++){for(var s in a[r]={},e.Rates[r])if("Symbol"===s)if(-1<[1,5].indexOf(parseFloat(e.Rates[r].ProductType))&&"Copper"!==e.Rates[r][s]){var n=e.Rates[r][s];a[r][s]=n.slice(0,3)+"/"+n.slice(3,6)}else a[r][s]=e.Rates[r][s];else{if("Spread"===s){var i=Math.round(10*parseFloat(e.Rates[r][s]))/10,o=Math.round(i)===i?i.toString()+".0":i.toString();a[r][s]=t?o.replace(".",","):o}else"vol"===s.substr(-3).toLocaleLowerCase()?a[r][s]=Number(e.Rates[r][s])<1e6?e.Rates[r][s].replace(/^(\d{3}).*/,"$1K"):e.Rates[r][s].replace(/^(\d)(\d).*/,"$1.$2M"):a[r][s]="ProductType"!==s&&t?e.Rates[r][s].replace(".",","):e.Rates[r][s];"object"==typeof l[r]?a[r][s+"Change"]=parseFloat((parseFloat(e.Rates[r][s])-parseFloat(l[r][s])).toFixed(5)):a[r][s+"Change"]=0}l[r]=e.Rates[r]}return a}return[]},this.doLiveRates=function(){if(s.isStatic())return!1;var e=moment.utc().tz("America/New_York"),t=!0,a=24*(e.day()-1)+e.hour()+e.minute()/60,r=e.hour()+e.minute()/60;return 111.5<a&&a<162?t=!1:16.25<r&&r<20&&(t=!1),t},this.getTimestamp=function(){return moment.utc().format("YYYY-MM-DD HH:mm:ss")+" UTC"}}]),r.filter("rateFilter",["configService",function(u){return function(e,t,a,r){var s=[];if("object"==typeof e&&e.length){var n=u.getProducts();n.length<1&&"string"==typeof a&&a.length&&(n=a.split(","));var i=u.getSymbols();"string"==typeof t&&t.length&&(i=t.split(","));var o=u.getExclusions();"string"==typeof r&&r.length&&o.push(r.split(","));for(var l=0;l<e.length;l++){var d=!0;if("object"==typeof e[l]&&"string"==typeof e[l].Symbol){var c=e[l].Symbol.split("/").join("");if(o.length&&-1<o.indexOf(c)?d=!1:n.length&&void 0!==e[l].ProductType&&n.indexOf(u.productTypeMap[parseFloat(e[l].ProductType)])<0?d=!1:i.length&&i.indexOf(c)<0&&(d=!1),i.length&&-1<i.indexOf(c))var p=i.indexOf(c)}else d=!1;d&&("number"==typeof p?s[p]=e[l]:s.push(e[l]))}}return s}}]),r.directive("ratesWidget",[function(){return{restrict:"AE",controller:["$scope","$interval","$timeout","configService","ratesService","fetchService",function(a,e,r,s,n,i){var t,o=s.getInterval(),l=s.getDeltaTimeout(),d=this;this.labels=s.generateLabels(),this.autoRefresh=s.doAutoRefresh(),a.rates=[],a.timestamp="",a.liveState=!0,a.updateRates=function(e){if(n.doLiveRates(a.static))i.getData(s.getExecution(),s.isMarketDepth()).then(function(e){a.rates=n.formatRates(e,d.labels.DecimalToComma),a.timestamp=n.getTimestamp(),l&&r(function(){for(var e in a.rates)a.rates[e].BidChange=a.rates[e].AskChange=a.rates[e].SpreadChange=0},l)}),a.liveState||(a.liveState=!0);else if(a.liveState)for(var t in a.rates=n.formatRates(fxcm.registration.getStaticRates(s.getExecution()),d.labels.DecimalToComma),a.liveState=!1,a.rates)a.rates[t].BidChange=a.rates[t].AskChange=a.rates[t].SpreadChange=0},a.startAutoUpdateRates=function(){a.updateRates(),angular.isDefined(t)||(t=e(function(){a.updateRates()},o))},a.stopAutoUpdateRates=function(){angular.isDefined(t)&&(e.cancel(t),t=void 0)},a.$on("$destroy",function(){a.stopAutoUpdateRates()}),a.$on("refreshRequest",function(){a.updateRates()}),d.autoRefresh?a.startAutoUpdateRates():a.updateRates()}]}}]),r.directive("rwView",["$templateCache",function(e){return{restrict:"AE",scope:{rates:"=",timestamp:"=",liveState:"=",symbols:"@?",products:"@?",exclude:"@?"},require:"^ratesWidget",templateUrl:function(e,t){return"string"==typeof t.templateUrl&&t.templateUrl.length?t.templateUrl:""},link:function(t,e,a,r){t.labels=r.labels,t.autoRefresh=r.autoRefresh,t.updateRates=function(e){void 0!==e&&e.preventDefault(),t.$emit("refreshRequest")}}}}])}},$(document).ready(function(){$(".fxcm-rates-widget").each(function(e,t){new fxcm.rates.Widget("#"+t.id,window[t.getAttribute("data-config-var")])})});
//# sourceMappingURL=rates-widget.min.js.map
