var econCal=new function(){var s="en";if("string"==typeof fxcmcom.base_path)switch(fxcmcom.base_path.slice(1,-1)){case"uk":moment.locale("uk");break;case"au":moment.locale("au");break;case"de":moment.locale("de"),s="de";break;case"fr":moment.locale("fr"),s="fr";break;case"it":moment.locale("it"),s="it";break;case"es":moment.locale("es"),s="es"}var p=["AUD","CAD","CHF","CNY","EUR","GBP","JPY","MXN","NOK","NZD","SEK","TRY","USD","ZAR"],i=[],v=$(),r="",d=new fxcm.ui.SmoothScroll({trigger:"#back-to-top",target:"#calendar-nav",animateSpeed:250}),o=function(e){if("string"!=typeof e)return!1;var t="desktop"===e?-10:0-($("#sticky").outerHeight()+10);d.setOffset(t)},c=function(e){if("string"!=typeof e)return!1;return/^[0-9]{4}-[0-1][0-9]-[0-3][0-9]$/.test(e)},m=function(e,t,a){if(!c(e)||!c(t))return!1;var n={contenttype:"economiccalendar",language:s,format:"json",description:"true",startdate:e.split("-").join(""),enddate:t.split("-").join(""),t:Date.now()};v.addClass("loading"),$.getJSON("https://content.fxcm.news/getData",n).done(function(e){"function"==typeof a&&a(e),v.removeClass("loading")}).fail(function(){console.log("Error: Calendar data could not be retrieved")})},u=function(e,t,a){if("object"!=typeof e||"object"!=typeof t||!t.length)return!1;e.currency=e.currency||p,e.volatility&&(e.importance=e.volatility,delete e.volatility),e.category&&(e.eventType=e.category,delete e.category);for(var n=[],s="number"==typeof a?a:0,i=0;i<t.length;i++){var r=0,o=0,c=parseInt(moment(t[i].dateTime).format("YYYYMMDD"));for(var l in e)if(e[l].length)switch(r++,l){case"rangeStart":parseInt(e.rangeStart.split("-").join(""))<=c&&o++;break;case"rangeEnd":c<=parseInt(e.rangeEnd.split("-").join(""))&&o++;break;case"keyword":var d=RegExp(e[l],"gi");(-1<t[i].name.search(d)||"string"==typeof t[i].description&&-1<t[i].description.search(d))&&o++;break;case"importance":(-1<e[l].indexOf("None")&&(!t[i][l]||"NA"===t[i][l])||-1<e[l].indexOf(t[i][l]))&&o++;break;default:"object"==typeof t[i]&&-1<e[l].indexOf(t[i][l])&&o++}if(o===r&&(t[i].countryCode="EMU"===t[i].countryCode?"eu":t[i].countryCode.toLowerCase(),n.push(t[i])),s&&n.length===s)break}return n.sort(function(e,t){if("object"!=typeof e||!e.dateTime||"object"!=typeof t||!t.dateTime)return 0;var a=" .,!?:$%#@*&()/-_0123456789abcdefghijklmnopqrstuvwxyz".split(""),n=0,s=0;function makeDateNum(e){return parseInt(e.substr(0,10).split("-").join("")+e.substr(11,8).split(":").join(""))}for(n=makeDateNum(e.dateTime)-makeDateNum(t.dateTime);0===n&&s<e.name.length&&s<t.name.length;)n=a.indexOf(e.name.charAt(s).toLowerCase())-a.indexOf(t.name.charAt(s).toLowerCase()),s++;return n}),n},f=function(e){var t=$("#custom-search .formBox"),a=$("#custom-search .confBox");e?(t.show(),a.hide()):(t.hide(),a.show())},l=function(){var r,o,c=$("#custom-search #cal-search"),e=moment(),n=c.find("#search-currencies"),t={locale:"uk",rangeMin:30,rangeMax:30,navType:"list",calType:"table",navNextHTML:'<i class="ico ico-white ico-14"><svg><use xlink:href="#ico-arrow-right"></use></svg></i>',navPrevHTML:'<i class="ico ico-white ico-14"><svg><use xlink:href="#ico-arrow-left"></use></svg></i>',alwaysSelectDay:!0,addClasses:{}},a=$.extend({},t),s=$.extend({},t),l="in-range";function updateRanges(e){var n=c.find("input#search-date-start").val(),s=c.find("input#search-date-end").val(),t=moment(n),a=moment(s),i=c.find(".weekly-calendar table td");return a.diff(t,"days")<0?("a"===e?o.goToDate(n):"b"===e&&r.goToDate(s),!1):30<a.diff(t,"days")?("a"===e?o.goToDate(t.add(30,"days")):"b"===e&&r.goToDate(a.subtract(30,"days")),!1):(i.removeClass(l),void i.each(function(){var e=parseInt($(this).attr("data-date").split("-").join("")),t=parseInt(n.split("-").join("")),a=parseInt(s.split("-").join(""));t<=e&&e<=a&&$(this).addClass(l)}))}a.daySelectCallback=function(e){c.find("input#search-date-start").val(e),updateRanges("a")},s.daySelectCallback=function(e){c.find("input#search-date-end").val(e),updateRanges("b")},r=new fxcm.ui.Calendar(c.find("#search-cal-a"),e,a),(o=new fxcm.ui.Calendar(c.find("#search-cal-b"),e,s)).goToDate(e.add(6,"d")),$.each(p,function(e,t){var a=$(document.createElement("div")).addClass("form-cell field-type-checkbox grid-20 tablet-grid-20 mobile-grid-50").append($(document.createElement("input")).addClass("checkbox").attr({id:"search-curr-"+t.toLowerCase(),name:"currency",value:t,type:"checkbox"})).append($(document.createElement("label")).attr("for","search-curr-"+t.toLowerCase()).html(t));n.append(a)}),c.find('a[href="#submit"]').on("click",function(e){e.preventDefault(),c.submit()}),c.on("submit",function(e){e.preventDefault();var t,a=(t={},c.find("input, select").each(function(){var e=$(this).attr("name");switch("select"===$(this).prop("tagName")?"select":$(this).attr("type")){case"text":case"hidden":case"select":t[e]=$(this).val();break;case"checkbox":t[e]=t[e]||[],$(this).prop("checked")&&t[e].push($(this).val())}}),t);if("object"==typeof a&&a.rangeStart&&a.rangeEnd){var n=moment(a.rangeStart).subtract(1,"days").format("YYYY-MM-DD"),s=moment(a.rangeEnd).add(1,"days").format("YYYY-MM-DD");m(n,s,function(e){h(u(a,e))})}f(!1),d.scrollNow()}),$("#search-refine").on("click",function(e){e.preventDefault(),f(!0)})},h=function(e){if(v.empty(),"object"!=typeof e||!e.length)return v.html('<div class="grid-100"><p class="txt-white padding-vertical-10 margin-0">No events found</p></div>'),!1;for(var t,a,n,s,i,r,o,c,l,d,p,m,u='<dl class="cal-list">',f=moment(),h=0;h<e.length;h++)a=moment(e[h].dateTime),moment.isMoment(t)&&!a.isAfter(t,"day")||(0<h&&(u+="</div>"),u+='<div class="day-wrap"><h5 class="day-title"><span>'+(t=a).format("dddd, MMMM DD YYYY")+"</span></h5>"),i=r="",n=a.diff(f)<0?"event-expired":"",s=e[h].importance&&"NA"!==e[h].importance?e[h].importance.toLowerCase():"none",d="string"==typeof e[h].eventPeriod&&e[h].eventPeriod.length?" ("+e[h].eventPeriod+")":"",p="string"==typeof e[h].description&&e[h].description.length?e[h].description:"N/A",o="string"==typeof e[h].displayPrevious&&e[h].displayPrevious.length?e[h].displayPrevious:'<span class="txt-grey-light">-</span>',c="string"==typeof e[h].displayForecast&&e[h].displayForecast.length?e[h].displayForecast:'<span class="txt-grey-light">-</span>',l="string"==typeof e[h].displayActual&&e[h].displayActual.length?e[h].displayActual:'<span class="txt-grey-light">-</span>',m="","string"==typeof e[h].displayRevised&&e[h].displayRevised.length&&(m='<div class="tooltip position-bottom"><p>Revised from <span>'+o+"</span></p></div>",o=e[h].displayRevised,i+="has-tooltip"),"number"==typeof e[h].actual&&"number"==typeof e[h].previous&&(e[h].actual>e[h].previous?r+=" change-up":e[h].actual<e[h].previous&&(r+=" change-down")),u+='<dt class="clearfix '+n+'"><ul class="event-summary"><li class="time"><span>'+a.format("HH:mm")+'</span></li><li class="currency">'+e[h].currency+'</li><li class="title"><span class="flag-icon flag-icon-'+e[h].countryCode+'" />'+e[h].name+d+'</li><li class="volatility"><div title="'+e[h].importance+'" class="volatility-ind '+s+'"></div></li><li class="advanced"><ul><li class="actual '+r+'"><span class="desktop-hide txt-Opensans-regular">Actual: </span><span class="val">'+l+'</span></li><li class="consensus"><span class="desktop-hide txt-Opensans-regular">Consensus: </span>'+c+'</li><li class="previous '+i+'"><span class="desktop-hide txt-Opensans-regular">Previous: </span><span class="val">'+o+"</span>"+m+'</li></ul></li></ul></dt><dd class="clearfix"><div class="event-details"><div class="grid-70 padding-top-20 padding-horizontal-20"><p>'+p+"</p></div></div></dd>";u+="</div></dl>",v.append(u),new fxcm.ui.ExpandableSet(v.find("dt")),v.find(".has-tooltip").each(function(){new fxcm.Tooltip(this)})},g=function(e){var t,a,n=e.attr("href"),s=$("#custom-search");if("string"!=typeof n||r===n)return!1;switch(r=n,s.removeClass("open"),n.substr(1)){case"recent":t=moment(),a=moment(t).add(6,"d");break;case"today":a=t=moment();break;case"tomorrow":a=t=moment().add(1,"d");break;case"thisweek":t=moment().startOf("week"),a=moment(t).add(6,"d");break;case"nextweek":t=moment().startOf("week").add(1,"w"),a=moment(t).add(6,"d");break;case"calsearch":s.addClass("open"),f(!0),h(!1)}t&&a&&h(u({rangeStart:t.format("YYYY-MM-DD"),rangeEnd:a.format("YYYY-MM-DD")},i))};this.initCalendar=function(e){if(v=$(e),!fxcm.lib.isJqueryElement(v))return!1;var t=moment().startOf("w").subtract(1,"d"),a=moment(t).add(3,"w"),n=$("#calendar-nav li").not(".nav3-selector").find("a");m(t.format("YYYY-MM-DD"),a.format("YYYY-MM-DD"),function(e){i=e,g(n.first())}),n.on("click",function(e){e.preventDefault(),n.parent().addClass("current-menu-item").siblings("li").removeClass("open").not($(this).parent()).removeClass("current-menu-item"),g($(this))}),l(),o(fxcm.device.getBreakpoint()),amplify.subscribe("fxcm.device.onBreakpointChange",function(e){o(e.breakpoint)})}};jQuery(document).ready(function(e){econCal.initCalendar(e("#economic-calendar"))});
//# sourceMappingURL=economic-calendar.min.js.map
